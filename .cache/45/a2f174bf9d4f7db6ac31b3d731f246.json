{"id":"A2T1","dependencies":[{"name":"C:\\Users\\jjiamei\\Desktop\\spotify-js\\package.json","includedInParent":true,"mtime":1671150119960}],"generated":{"js":"const e=require(\"path\");require(\"dotenv\").config({path:__dirname+\"/.env\"});var r=require(\"express\"),t=require(\"request\"),o=require(\"cors\"),s=require(\"querystring\"),i=require(\"cookie-parser\"),n=process.env.CLIENT_ID,a=process.env.CLIENT_SECRET,c=process.env.REDIRECT_URI,u=function(e){for(var r=\"\",t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",o=0;o<e;o++)r+=t.charAt(Math.floor(Math.random()*t.length));return r},f=\"spotify_auth_state\",p=r();p.use(r.static(__dirname+\"/\")).use(o()).use(i()),p.get(\"/login\",function(e,r){var t=u(16);r.cookie(f,t);r.redirect(\"https://accounts.spotify.com/authorize?\"+s.stringify({response_type:\"code\",client_id:n,scope:\"user-read-private user-read-email user-top-read\",redirect_uri:c,state:t}))}),p.get(\"/callback\",function(e,r){var o=e.query.code||null,i=e.query.state||null,u=e.cookies?e.cookies[f]:null;if(null===i||i!==u)r.redirect(\"/#\"+s.stringify({error:\"state_mismatch\"}));else{r.clearCookie(f);var p={url:\"https://accounts.spotify.com/api/token\",form:{code:o,redirect_uri:c,grant_type:\"authorization_code\"},headers:{Authorization:\"Basic \"+new Buffer(n+\":\"+a).toString(\"base64\")},json:!0};t.post(p,function(e,o,i){if(e||200!==o.statusCode)r.redirect(\"/#\"+s.stringify({error:\"invalid_token\"}));else{var n=i.access_token,a=i.refresh_token,c={url:\"https://api.spotify.com/v1/me\",headers:{Authorization:\"Bearer \"+n},json:!0};t.get(c,function(e,r,t){console.log(t)}),r.redirect(\"/#\"+s.stringify({access_token:n,refresh_token:a}))}})}}),p.get(\"/refresh_token\",function(e,r){var o=e.query.refresh_token,s={url:\"https://accounts.spotify.com/api/token\",headers:{Authorization:\"Basic \"+new Buffer(n+\":\"+a).toString(\"base64\")},form:{grant_type:\"refresh_token\",refresh_token:o},json:!0};t.post(s,function(e,t,o){if(!e&&200===t.statusCode){var s=o.access_token;r.send({access_token:s})}})}),console.log(\"Listening on 8888\"),p.listen(8888);"},"sourceMaps":{"js":{"mappings":[{"source":"app.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"app.js","name":"path","original":{"line":1,"column":6},"generated":{"line":1,"column":6}},{"source":"app.js","name":"require","original":{"line":1,"column":13},"generated":{"line":1,"column":8}},{"source":"app.js","original":{"line":1,"column":21},"generated":{"line":1,"column":16}},{"source":"app.js","name":"require","original":{"line":2,"column":0},"generated":{"line":1,"column":24}},{"source":"app.js","original":{"line":2,"column":8},"generated":{"line":1,"column":32}},{"source":"app.js","name":"config","original":{"line":2,"column":18},"generated":{"line":1,"column":42}},{"source":"app.js","original":{"line":2,"column":25},"generated":{"line":1,"column":49}},{"source":"app.js","name":"path","original":{"line":2,"column":26},"generated":{"line":1,"column":50}},{"source":"app.js","name":"__dirname","original":{"line":2,"column":31},"generated":{"line":1,"column":55}},{"source":"app.js","original":{"line":2,"column":41},"generated":{"line":1,"column":65}},{"source":"app.js","original":{"line":3,"column":0},"generated":{"line":1,"column":75}},{"source":"app.js","name":"express","original":{"line":3,"column":4},"generated":{"line":1,"column":79}},{"source":"app.js","name":"require","original":{"line":3,"column":14},"generated":{"line":1,"column":81}},{"source":"app.js","original":{"line":3,"column":22},"generated":{"line":1,"column":89}},{"source":"app.js","name":"request","original":{"line":4,"column":4},"generated":{"line":1,"column":100}},{"source":"app.js","name":"require","original":{"line":4,"column":14},"generated":{"line":1,"column":102}},{"source":"app.js","original":{"line":4,"column":22},"generated":{"line":1,"column":110}},{"source":"app.js","name":"cors","original":{"line":5,"column":4},"generated":{"line":1,"column":121}},{"source":"app.js","name":"require","original":{"line":5,"column":11},"generated":{"line":1,"column":123}},{"source":"app.js","original":{"line":5,"column":19},"generated":{"line":1,"column":131}},{"source":"app.js","name":"querystring","original":{"line":6,"column":4},"generated":{"line":1,"column":139}},{"source":"app.js","name":"require","original":{"line":6,"column":18},"generated":{"line":1,"column":141}},{"source":"app.js","original":{"line":6,"column":26},"generated":{"line":1,"column":149}},{"source":"app.js","name":"cookieParser","original":{"line":7,"column":4},"generated":{"line":1,"column":164}},{"source":"app.js","name":"require","original":{"line":7,"column":19},"generated":{"line":1,"column":166}},{"source":"app.js","original":{"line":7,"column":27},"generated":{"line":1,"column":174}},{"source":"app.js","name":"client_id","original":{"line":9,"column":4},"generated":{"line":1,"column":191}},{"source":"app.js","name":"process","original":{"line":9,"column":16},"generated":{"line":1,"column":193}},{"source":"app.js","name":"env","original":{"line":9,"column":24},"generated":{"line":1,"column":201}},{"source":"app.js","name":"CLIENT_ID","original":{"line":9,"column":28},"generated":{"line":1,"column":205}},{"source":"app.js","name":"client_secret","original":{"line":10,"column":4},"generated":{"line":1,"column":215}},{"source":"app.js","name":"process","original":{"line":10,"column":20},"generated":{"line":1,"column":217}},{"source":"app.js","name":"env","original":{"line":10,"column":28},"generated":{"line":1,"column":225}},{"source":"app.js","name":"CLIENT_SECRET","original":{"line":10,"column":32},"generated":{"line":1,"column":229}},{"source":"app.js","name":"redirect_uri","original":{"line":11,"column":4},"generated":{"line":1,"column":243}},{"source":"app.js","name":"process","original":{"line":11,"column":19},"generated":{"line":1,"column":245}},{"source":"app.js","name":"env","original":{"line":11,"column":27},"generated":{"line":1,"column":253}},{"source":"app.js","name":"REDIRECT_URI","original":{"line":11,"column":31},"generated":{"line":1,"column":257}},{"source":"app.js","name":"generateRandomString","original":{"line":18,"column":4},"generated":{"line":1,"column":270}},{"source":"app.js","original":{"line":18,"column":27},"generated":{"line":1,"column":272}},{"source":"app.js","name":"length","original":{"line":18,"column":36},"generated":{"line":1,"column":281}},{"source":"app.js","original":{"line":22,"column":2},"generated":{"line":1,"column":284}},{"source":"app.js","original":{"line":19,"column":2},"generated":{"line":1,"column":288}},{"source":"app.js","name":"text","original":{"line":19,"column":6},"generated":{"line":1,"column":292}},{"source":"app.js","original":{"line":19,"column":13},"generated":{"line":1,"column":294}},{"source":"app.js","name":"possible","original":{"line":20,"column":6},"generated":{"line":1,"column":297}},{"source":"app.js","original":{"line":20,"column":17},"generated":{"line":1,"column":299}},{"source":"app.js","name":"i","original":{"line":22,"column":11},"generated":{"line":1,"column":364}},{"source":"app.js","original":{"line":22,"column":15},"generated":{"line":1,"column":366}},{"source":"app.js","name":"i","original":{"line":22,"column":18},"generated":{"line":1,"column":368}},{"source":"app.js","name":"length","original":{"line":22,"column":22},"generated":{"line":1,"column":370}},{"source":"app.js","name":"i","original":{"line":22,"column":30},"generated":{"line":1,"column":372}},{"source":"app.js","name":"text","original":{"line":23,"column":4},"generated":{"line":1,"column":376}},{"source":"app.js","name":"possible","original":{"line":23,"column":12},"generated":{"line":1,"column":379}},{"source":"app.js","name":"charAt","original":{"line":23,"column":21},"generated":{"line":1,"column":381}},{"source":"app.js","name":"Math","original":{"line":23,"column":28},"generated":{"line":1,"column":388}},{"source":"app.js","name":"floor","original":{"line":23,"column":33},"generated":{"line":1,"column":393}},{"source":"app.js","name":"Math","original":{"line":23,"column":39},"generated":{"line":1,"column":399}},{"source":"app.js","name":"random","original":{"line":23,"column":44},"generated":{"line":1,"column":404}},{"source":"app.js","name":"possible","original":{"line":23,"column":55},"generated":{"line":1,"column":413}},{"source":"app.js","name":"length","original":{"line":23,"column":64},"generated":{"line":1,"column":415}},{"source":"app.js","original":{"line":25,"column":2},"generated":{"line":1,"column":424}},{"source":"app.js","name":"text","original":{"line":25,"column":9},"generated":{"line":1,"column":431}},{"source":"app.js","name":"stateKey","original":{"line":28,"column":4},"generated":{"line":1,"column":434}},{"source":"app.js","original":{"line":28,"column":15},"generated":{"line":1,"column":436}},{"source":"app.js","name":"app","original":{"line":30,"column":4},"generated":{"line":1,"column":457}},{"source":"app.js","name":"express","original":{"line":30,"column":10},"generated":{"line":1,"column":459}},{"source":"app.js","name":"app","original":{"line":32,"column":0},"generated":{"line":1,"column":463}},{"source":"app.js","name":"use","original":{"line":32,"column":4},"generated":{"line":1,"column":465}},{"source":"app.js","name":"express","original":{"line":32,"column":8},"generated":{"line":1,"column":469}},{"source":"app.js","name":"static","original":{"line":32,"column":16},"generated":{"line":1,"column":471}},{"source":"app.js","name":"__dirname","original":{"line":32,"column":23},"generated":{"line":1,"column":478}},{"source":"app.js","original":{"line":32,"column":35},"generated":{"line":1,"column":488}},{"source":"app.js","name":"use","original":{"line":33,"column":4},"generated":{"line":1,"column":494}},{"source":"app.js","name":"cors","original":{"line":33,"column":8},"generated":{"line":1,"column":498}},{"source":"app.js","name":"use","original":{"line":34,"column":4},"generated":{"line":1,"column":503}},{"source":"app.js","name":"cookieParser","original":{"line":34,"column":8},"generated":{"line":1,"column":507}},{"source":"app.js","name":"app","original":{"line":36,"column":0},"generated":{"line":1,"column":512}},{"source":"app.js","name":"get","original":{"line":36,"column":4},"generated":{"line":1,"column":514}},{"source":"app.js","original":{"line":36,"column":8},"generated":{"line":1,"column":518}},{"source":"app.js","original":{"line":36,"column":18},"generated":{"line":1,"column":527}},{"source":"app.js","name":"req","original":{"line":36,"column":27},"generated":{"line":1,"column":536}},{"source":"app.js","name":"res","original":{"line":36,"column":32},"generated":{"line":1,"column":538}},{"source":"app.js","original":{"line":38,"column":2},"generated":{"line":1,"column":541}},{"source":"app.js","name":"state","original":{"line":38,"column":6},"generated":{"line":1,"column":545}},{"source":"app.js","name":"generateRandomString","original":{"line":38,"column":14},"generated":{"line":1,"column":547}},{"source":"app.js","original":{"line":38,"column":35},"generated":{"line":1,"column":549}},{"source":"app.js","name":"res","original":{"line":39,"column":2},"generated":{"line":1,"column":553}},{"source":"app.js","name":"cookie","original":{"line":39,"column":6},"generated":{"line":1,"column":555}},{"source":"app.js","name":"stateKey","original":{"line":39,"column":13},"generated":{"line":1,"column":562}},{"source":"app.js","name":"state","original":{"line":39,"column":23},"generated":{"line":1,"column":564}},{"source":"app.js","name":"res","original":{"line":43,"column":2},"generated":{"line":1,"column":567}},{"source":"app.js","name":"redirect","original":{"line":43,"column":6},"generated":{"line":1,"column":569}},{"source":"app.js","original":{"line":43,"column":15},"generated":{"line":1,"column":578}},{"source":"app.js","name":"querystring","original":{"line":44,"column":4},"generated":{"line":1,"column":620}},{"source":"app.js","name":"stringify","original":{"line":44,"column":16},"generated":{"line":1,"column":622}},{"source":"app.js","original":{"line":44,"column":26},"generated":{"line":1,"column":632}},{"source":"app.js","name":"response_type","original":{"line":45,"column":6},"generated":{"line":1,"column":633}},{"source":"app.js","original":{"line":45,"column":21},"generated":{"line":1,"column":647}},{"source":"app.js","name":"client_id","original":{"line":46,"column":6},"generated":{"line":1,"column":654}},{"source":"app.js","name":"client_id","original":{"line":46,"column":17},"generated":{"line":1,"column":664}},{"source":"app.js","name":"scope","original":{"line":47,"column":6},"generated":{"line":1,"column":666}},{"source":"app.js","original":{"line":42,"column":14},"generated":{"line":1,"column":672}},{"source":"app.js","name":"redirect_uri","original":{"line":48,"column":6},"generated":{"line":1,"column":722}},{"source":"app.js","name":"redirect_uri","original":{"line":48,"column":20},"generated":{"line":1,"column":735}},{"source":"app.js","name":"state","original":{"line":49,"column":6},"generated":{"line":1,"column":737}},{"source":"app.js","name":"state","original":{"line":49,"column":13},"generated":{"line":1,"column":743}},{"source":"app.js","name":"app","original":{"line":53,"column":0},"generated":{"line":1,"column":750}},{"source":"app.js","name":"get","original":{"line":53,"column":4},"generated":{"line":1,"column":752}},{"source":"app.js","original":{"line":53,"column":8},"generated":{"line":1,"column":756}},{"source":"app.js","original":{"line":53,"column":21},"generated":{"line":1,"column":768}},{"source":"app.js","name":"req","original":{"line":53,"column":30},"generated":{"line":1,"column":777}},{"source":"app.js","name":"res","original":{"line":53,"column":35},"generated":{"line":1,"column":779}},{"source":"app.js","original":{"line":58,"column":2},"generated":{"line":1,"column":782}},{"source":"app.js","name":"code","original":{"line":58,"column":6},"generated":{"line":1,"column":786}},{"source":"app.js","name":"req","original":{"line":58,"column":13},"generated":{"line":1,"column":788}},{"source":"app.js","name":"query","original":{"line":58,"column":17},"generated":{"line":1,"column":790}},{"source":"app.js","name":"code","original":{"line":58,"column":23},"generated":{"line":1,"column":796}},{"source":"app.js","original":{"line":58,"column":31},"generated":{"line":1,"column":802}},{"source":"app.js","name":"state","original":{"line":59,"column":6},"generated":{"line":1,"column":807}},{"source":"app.js","name":"req","original":{"line":59,"column":14},"generated":{"line":1,"column":809}},{"source":"app.js","name":"query","original":{"line":59,"column":18},"generated":{"line":1,"column":811}},{"source":"app.js","name":"state","original":{"line":59,"column":24},"generated":{"line":1,"column":817}},{"source":"app.js","original":{"line":59,"column":33},"generated":{"line":1,"column":824}},{"source":"app.js","name":"storedState","original":{"line":60,"column":6},"generated":{"line":1,"column":829}},{"source":"app.js","name":"req","original":{"line":60,"column":20},"generated":{"line":1,"column":831}},{"source":"app.js","name":"cookies","original":{"line":60,"column":24},"generated":{"line":1,"column":833}},{"source":"app.js","name":"req","original":{"line":60,"column":34},"generated":{"line":1,"column":841}},{"source":"app.js","name":"cookies","original":{"line":60,"column":38},"generated":{"line":1,"column":843}},{"source":"app.js","name":"stateKey","original":{"line":60,"column":46},"generated":{"line":1,"column":851}},{"source":"app.js","original":{"line":60,"column":58},"generated":{"line":1,"column":854}},{"source":"app.js","original":{"line":62,"column":2},"generated":{"line":1,"column":859}},{"source":"app.js","original":{"line":62,"column":16},"generated":{"line":1,"column":862}},{"source":"app.js","name":"state","original":{"line":62,"column":6},"generated":{"line":1,"column":869}},{"source":"app.js","name":"state","original":{"line":62,"column":24},"generated":{"line":1,"column":872}},{"source":"app.js","name":"storedState","original":{"line":62,"column":34},"generated":{"line":1,"column":876}},{"source":"app.js","name":"res","original":{"line":63,"column":4},"generated":{"line":1,"column":878}},{"source":"app.js","name":"redirect","original":{"line":63,"column":8},"generated":{"line":1,"column":880}},{"source":"app.js","original":{"line":63,"column":17},"generated":{"line":1,"column":889}},{"source":"app.js","name":"querystring","original":{"line":64,"column":6},"generated":{"line":1,"column":894}},{"source":"app.js","name":"stringify","original":{"line":64,"column":18},"generated":{"line":1,"column":896}},{"source":"app.js","original":{"line":64,"column":28},"generated":{"line":1,"column":906}},{"source":"app.js","name":"error","original":{"line":65,"column":8},"generated":{"line":1,"column":907}},{"source":"app.js","original":{"line":65,"column":15},"generated":{"line":1,"column":913}},{"source":"app.js","original":{"line":67,"column":9},"generated":{"line":1,"column":937}},{"source":"app.js","name":"res","original":{"line":68,"column":4},"generated":{"line":1,"column":938}},{"source":"app.js","name":"clearCookie","original":{"line":68,"column":8},"generated":{"line":1,"column":940}},{"source":"app.js","name":"stateKey","original":{"line":68,"column":20},"generated":{"line":1,"column":952}},{"source":"app.js","original":{"line":69,"column":4},"generated":{"line":1,"column":955}},{"source":"app.js","name":"authOptions","original":{"line":69,"column":8},"generated":{"line":1,"column":959}},{"source":"app.js","original":{"line":69,"column":22},"generated":{"line":1,"column":961}},{"source":"app.js","name":"url","original":{"line":70,"column":6},"generated":{"line":1,"column":962}},{"source":"app.js","original":{"line":70,"column":11},"generated":{"line":1,"column":966}},{"source":"app.js","name":"form","original":{"line":71,"column":6},"generated":{"line":1,"column":1007}},{"source":"app.js","original":{"line":71,"column":12},"generated":{"line":1,"column":1012}},{"source":"app.js","name":"code","original":{"line":72,"column":8},"generated":{"line":1,"column":1013}},{"source":"app.js","name":"code","original":{"line":72,"column":14},"generated":{"line":1,"column":1018}},{"source":"app.js","name":"redirect_uri","original":{"line":73,"column":8},"generated":{"line":1,"column":1020}},{"source":"app.js","name":"redirect_uri","original":{"line":73,"column":22},"generated":{"line":1,"column":1033}},{"source":"app.js","name":"grant_type","original":{"line":74,"column":8},"generated":{"line":1,"column":1035}},{"source":"app.js","original":{"line":74,"column":20},"generated":{"line":1,"column":1046}},{"source":"app.js","name":"headers","original":{"line":76,"column":6},"generated":{"line":1,"column":1068}},{"source":"app.js","original":{"line":76,"column":15},"generated":{"line":1,"column":1076}},{"source":"app.js","original":{"line":77,"column":8},"generated":{"line":1,"column":1077}},{"source":"app.js","original":{"line":77,"column":25},"generated":{"line":1,"column":1091}},{"source":"app.js","original":{"line":77,"column":37},"generated":{"line":1,"column":1100}},{"source":"app.js","name":"Buffer","original":{"line":77,"column":41},"generated":{"line":1,"column":1104}},{"source":"app.js","name":"client_id","original":{"line":77,"column":48},"generated":{"line":1,"column":1111}},{"source":"app.js","original":{"line":77,"column":60},"generated":{"line":1,"column":1113}},{"source":"app.js","name":"client_secret","original":{"line":77,"column":66},"generated":{"line":1,"column":1117}},{"source":"app.js","name":"toString","original":{"line":77,"column":81},"generated":{"line":1,"column":1120}},{"source":"app.js","original":{"line":77,"column":90},"generated":{"line":1,"column":1129}},{"source":"app.js","name":"json","original":{"line":79,"column":6},"generated":{"line":1,"column":1140}},{"source":"app.js","original":{"line":79,"column":12},"generated":{"line":1,"column":1146}},{"source":"app.js","name":"request","original":{"line":82,"column":4},"generated":{"line":1,"column":1149}},{"source":"app.js","name":"post","original":{"line":82,"column":12},"generated":{"line":1,"column":1151}},{"source":"app.js","name":"authOptions","original":{"line":82,"column":17},"generated":{"line":1,"column":1156}},{"source":"app.js","original":{"line":82,"column":30},"generated":{"line":1,"column":1158}},{"source":"app.js","name":"error","original":{"line":82,"column":39},"generated":{"line":1,"column":1167}},{"source":"app.js","name":"response","original":{"line":82,"column":46},"generated":{"line":1,"column":1169}},{"source":"app.js","name":"body","original":{"line":82,"column":56},"generated":{"line":1,"column":1171}},{"source":"app.js","original":{"line":83,"column":6},"generated":{"line":1,"column":1174}},{"source":"app.js","name":"error","original":{"line":83,"column":11},"generated":{"line":1,"column":1177}},{"source":"app.js","original":{"line":83,"column":44},"generated":{"line":1,"column":1180}},{"source":"app.js","name":"response","original":{"line":83,"column":20},"generated":{"line":1,"column":1186}},{"source":"app.js","name":"statusCode","original":{"line":83,"column":29},"generated":{"line":1,"column":1188}},{"source":"app.js","name":"res","original":{"line":106,"column":8},"generated":{"line":1,"column":1199}},{"source":"app.js","name":"redirect","original":{"line":106,"column":12},"generated":{"line":1,"column":1201}},{"source":"app.js","original":{"line":106,"column":21},"generated":{"line":1,"column":1210}},{"source":"app.js","name":"querystring","original":{"line":107,"column":10},"generated":{"line":1,"column":1215}},{"source":"app.js","name":"stringify","original":{"line":107,"column":22},"generated":{"line":1,"column":1217}},{"source":"app.js","original":{"line":107,"column":32},"generated":{"line":1,"column":1227}},{"source":"app.js","name":"error","original":{"line":108,"column":12},"generated":{"line":1,"column":1228}},{"source":"app.js","original":{"line":108,"column":19},"generated":{"line":1,"column":1234}},{"source":"app.js","original":{"line":83,"column":49},"generated":{"line":1,"column":1257}},{"source":"app.js","original":{"line":85,"column":8},"generated":{"line":1,"column":1258}},{"source":"app.js","name":"access_token","original":{"line":85,"column":12},"generated":{"line":1,"column":1262}},{"source":"app.js","name":"body","original":{"line":85,"column":27},"generated":{"line":1,"column":1264}},{"source":"app.js","name":"access_token","original":{"line":85,"column":32},"generated":{"line":1,"column":1266}},{"source":"app.js","name":"refresh_token","original":{"line":86,"column":12},"generated":{"line":1,"column":1279}},{"source":"app.js","name":"body","original":{"line":86,"column":28},"generated":{"line":1,"column":1281}},{"source":"app.js","name":"refresh_token","original":{"line":86,"column":33},"generated":{"line":1,"column":1283}},{"source":"app.js","name":"options","original":{"line":88,"column":12},"generated":{"line":1,"column":1297}},{"source":"app.js","original":{"line":88,"column":22},"generated":{"line":1,"column":1299}},{"source":"app.js","name":"url","original":{"line":89,"column":10},"generated":{"line":1,"column":1300}},{"source":"app.js","original":{"line":89,"column":15},"generated":{"line":1,"column":1304}},{"source":"app.js","name":"headers","original":{"line":90,"column":10},"generated":{"line":1,"column":1336}},{"source":"app.js","original":{"line":90,"column":19},"generated":{"line":1,"column":1344}},{"source":"app.js","original":{"line":90,"column":21},"generated":{"line":1,"column":1345}},{"source":"app.js","original":{"line":90,"column":38},"generated":{"line":1,"column":1359}},{"source":"app.js","name":"access_token","original":{"line":90,"column":50},"generated":{"line":1,"column":1369}},{"source":"app.js","name":"json","original":{"line":91,"column":10},"generated":{"line":1,"column":1372}},{"source":"app.js","original":{"line":91,"column":16},"generated":{"line":1,"column":1378}},{"source":"app.js","name":"request","original":{"line":95,"column":8},"generated":{"line":1,"column":1381}},{"source":"app.js","name":"get","original":{"line":95,"column":16},"generated":{"line":1,"column":1383}},{"source":"app.js","name":"options","original":{"line":95,"column":20},"generated":{"line":1,"column":1387}},{"source":"app.js","original":{"line":95,"column":29},"generated":{"line":1,"column":1389}},{"source":"app.js","name":"error","original":{"line":95,"column":38},"generated":{"line":1,"column":1398}},{"source":"app.js","name":"response","original":{"line":95,"column":45},"generated":{"line":1,"column":1400}},{"source":"app.js","name":"body","original":{"line":95,"column":55},"generated":{"line":1,"column":1402}},{"source":"app.js","name":"console","original":{"line":96,"column":10},"generated":{"line":1,"column":1405}},{"source":"app.js","name":"log","original":{"line":96,"column":18},"generated":{"line":1,"column":1413}},{"source":"app.js","name":"body","original":{"line":96,"column":22},"generated":{"line":1,"column":1417}},{"source":"app.js","name":"res","original":{"line":100,"column":8},"generated":{"line":1,"column":1422}},{"source":"app.js","name":"redirect","original":{"line":100,"column":12},"generated":{"line":1,"column":1424}},{"source":"app.js","original":{"line":100,"column":21},"generated":{"line":1,"column":1433}},{"source":"app.js","name":"querystring","original":{"line":101,"column":10},"generated":{"line":1,"column":1438}},{"source":"app.js","name":"stringify","original":{"line":101,"column":22},"generated":{"line":1,"column":1440}},{"source":"app.js","original":{"line":101,"column":32},"generated":{"line":1,"column":1450}},{"source":"app.js","name":"access_token","original":{"line":102,"column":12},"generated":{"line":1,"column":1451}},{"source":"app.js","name":"access_token","original":{"line":102,"column":26},"generated":{"line":1,"column":1464}},{"source":"app.js","name":"refresh_token","original":{"line":103,"column":12},"generated":{"line":1,"column":1466}},{"source":"app.js","name":"refresh_token","original":{"line":103,"column":27},"generated":{"line":1,"column":1480}},{"source":"app.js","name":"app","original":{"line":115,"column":0},"generated":{"line":1,"column":1491}},{"source":"app.js","name":"get","original":{"line":115,"column":4},"generated":{"line":1,"column":1493}},{"source":"app.js","original":{"line":115,"column":8},"generated":{"line":1,"column":1497}},{"source":"app.js","original":{"line":115,"column":26},"generated":{"line":1,"column":1514}},{"source":"app.js","name":"req","original":{"line":115,"column":35},"generated":{"line":1,"column":1523}},{"source":"app.js","name":"res","original":{"line":115,"column":40},"generated":{"line":1,"column":1525}},{"source":"app.js","original":{"line":118,"column":2},"generated":{"line":1,"column":1528}},{"source":"app.js","name":"refresh_token","original":{"line":118,"column":6},"generated":{"line":1,"column":1532}},{"source":"app.js","name":"req","original":{"line":118,"column":22},"generated":{"line":1,"column":1534}},{"source":"app.js","name":"query","original":{"line":118,"column":26},"generated":{"line":1,"column":1536}},{"source":"app.js","name":"refresh_token","original":{"line":118,"column":32},"generated":{"line":1,"column":1542}},{"source":"app.js","name":"authOptions","original":{"line":119,"column":6},"generated":{"line":1,"column":1556}},{"source":"app.js","original":{"line":119,"column":20},"generated":{"line":1,"column":1558}},{"source":"app.js","name":"url","original":{"line":120,"column":4},"generated":{"line":1,"column":1559}},{"source":"app.js","original":{"line":120,"column":9},"generated":{"line":1,"column":1563}},{"source":"app.js","name":"headers","original":{"line":121,"column":4},"generated":{"line":1,"column":1604}},{"source":"app.js","original":{"line":121,"column":13},"generated":{"line":1,"column":1612}},{"source":"app.js","original":{"line":121,"column":15},"generated":{"line":1,"column":1613}},{"source":"app.js","original":{"line":121,"column":32},"generated":{"line":1,"column":1627}},{"source":"app.js","original":{"line":121,"column":44},"generated":{"line":1,"column":1636}},{"source":"app.js","name":"Buffer","original":{"line":121,"column":48},"generated":{"line":1,"column":1640}},{"source":"app.js","name":"client_id","original":{"line":121,"column":55},"generated":{"line":1,"column":1647}},{"source":"app.js","original":{"line":121,"column":67},"generated":{"line":1,"column":1649}},{"source":"app.js","name":"client_secret","original":{"line":121,"column":73},"generated":{"line":1,"column":1653}},{"source":"app.js","name":"toString","original":{"line":121,"column":88},"generated":{"line":1,"column":1656}},{"source":"app.js","original":{"line":121,"column":97},"generated":{"line":1,"column":1665}},{"source":"app.js","name":"form","original":{"line":122,"column":4},"generated":{"line":1,"column":1676}},{"source":"app.js","original":{"line":122,"column":10},"generated":{"line":1,"column":1681}},{"source":"app.js","name":"grant_type","original":{"line":123,"column":6},"generated":{"line":1,"column":1682}},{"source":"app.js","original":{"line":123,"column":18},"generated":{"line":1,"column":1693}},{"source":"app.js","name":"refresh_token","original":{"line":124,"column":6},"generated":{"line":1,"column":1709}},{"source":"app.js","name":"refresh_token","original":{"line":124,"column":21},"generated":{"line":1,"column":1723}},{"source":"app.js","name":"json","original":{"line":126,"column":4},"generated":{"line":1,"column":1726}},{"source":"app.js","original":{"line":126,"column":10},"generated":{"line":1,"column":1732}},{"source":"app.js","name":"request","original":{"line":129,"column":2},"generated":{"line":1,"column":1735}},{"source":"app.js","name":"post","original":{"line":129,"column":10},"generated":{"line":1,"column":1737}},{"source":"app.js","name":"authOptions","original":{"line":129,"column":15},"generated":{"line":1,"column":1742}},{"source":"app.js","original":{"line":129,"column":28},"generated":{"line":1,"column":1744}},{"source":"app.js","name":"error","original":{"line":129,"column":37},"generated":{"line":1,"column":1753}},{"source":"app.js","name":"response","original":{"line":129,"column":44},"generated":{"line":1,"column":1755}},{"source":"app.js","name":"body","original":{"line":129,"column":54},"generated":{"line":1,"column":1757}},{"source":"app.js","original":{"line":130,"column":4},"generated":{"line":1,"column":1760}},{"source":"app.js","name":"error","original":{"line":130,"column":9},"generated":{"line":1,"column":1764}},{"source":"app.js","original":{"line":130,"column":42},"generated":{"line":1,"column":1767}},{"source":"app.js","name":"response","original":{"line":130,"column":18},"generated":{"line":1,"column":1773}},{"source":"app.js","name":"statusCode","original":{"line":130,"column":27},"generated":{"line":1,"column":1775}},{"source":"app.js","original":{"line":130,"column":47},"generated":{"line":1,"column":1786}},{"source":"app.js","original":{"line":131,"column":6},"generated":{"line":1,"column":1787}},{"source":"app.js","name":"access_token","original":{"line":131,"column":10},"generated":{"line":1,"column":1791}},{"source":"app.js","name":"body","original":{"line":131,"column":25},"generated":{"line":1,"column":1793}},{"source":"app.js","name":"access_token","original":{"line":131,"column":30},"generated":{"line":1,"column":1795}},{"source":"app.js","name":"res","original":{"line":132,"column":6},"generated":{"line":1,"column":1808}},{"source":"app.js","name":"send","original":{"line":132,"column":10},"generated":{"line":1,"column":1810}},{"source":"app.js","original":{"line":132,"column":15},"generated":{"line":1,"column":1815}},{"source":"app.js","original":{"line":133,"column":8},"generated":{"line":1,"column":1816}},{"source":"app.js","name":"access_token","original":{"line":133,"column":24},"generated":{"line":1,"column":1829}},{"source":"app.js","name":"console","original":{"line":139,"column":0},"generated":{"line":1,"column":1838}},{"source":"app.js","name":"log","original":{"line":139,"column":8},"generated":{"line":1,"column":1846}},{"source":"app.js","original":{"line":139,"column":12},"generated":{"line":1,"column":1850}},{"source":"app.js","name":"app","original":{"line":140,"column":0},"generated":{"line":1,"column":1871}},{"source":"app.js","name":"listen","original":{"line":140,"column":4},"generated":{"line":1,"column":1873}},{"source":"app.js","original":{"line":140,"column":11},"generated":{"line":1,"column":1880}}],"sources":{"app.js":"const path = require('path')\r\nrequire('dotenv').config({path:__dirname+'/.env'});\r\nvar express = require('express'); // Express web server framework\r\nvar request = require('request'); // \"Request\" library\r\nvar cors = require('cors');\r\nvar querystring = require('querystring');\r\nvar cookieParser = require('cookie-parser');\r\n\r\nvar client_id = process.env.CLIENT_ID; // Your client id\r\nvar client_secret = process.env.CLIENT_SECRET; // Your secret\r\nvar redirect_uri = process.env.REDIRECT_URI; // Your redirect uri\r\n\r\n/**\r\n * Generates a random string containing numbers and letters\r\n * @param  {number} length The length of the string\r\n * @return {string} The generated string\r\n */\r\nvar generateRandomString = function(length) {\r\n  var text = '';\r\n  var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n\r\n  for (var i = 0; i < length; i++) {\r\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\r\n  }\r\n  return text;\r\n};\r\n\r\nvar stateKey = 'spotify_auth_state';\r\n\r\nvar app = express();\r\n\r\napp.use(express.static(__dirname + '/'))\r\n   .use(cors())\r\n   .use(cookieParser());\r\n\r\napp.get('/login', function(req, res) {\r\n\r\n  var state = generateRandomString(16);\r\n  res.cookie(stateKey, state);\r\n\r\n  // your application requests authorization\r\n  var scope = 'user-read-private user-read-email user-top-read';\r\n  res.redirect('https://accounts.spotify.com/authorize?' +\r\n    querystring.stringify({\r\n      response_type: 'code',\r\n      client_id: client_id,\r\n      scope: scope,\r\n      redirect_uri: redirect_uri,\r\n      state: state\r\n    }));\r\n});\r\n\r\napp.get('/callback', function(req, res) {\r\n\r\n  // your application requests refresh and access tokens\r\n  // after checking the state parameter\r\n\r\n  var code = req.query.code || null;\r\n  var state = req.query.state || null;\r\n  var storedState = req.cookies ? req.cookies[stateKey] : null;\r\n\r\n  if (state === null || state !== storedState) {\r\n    res.redirect('/#' +\r\n      querystring.stringify({\r\n        error: 'state_mismatch'\r\n      }));\r\n  } else {\r\n    res.clearCookie(stateKey);\r\n    var authOptions = {\r\n      url: 'https://accounts.spotify.com/api/token',\r\n      form: {\r\n        code: code,\r\n        redirect_uri: redirect_uri,\r\n        grant_type: 'authorization_code'\r\n      },\r\n      headers: {\r\n        'Authorization': 'Basic ' + (new Buffer(client_id + ':' + client_secret).toString('base64'))\r\n      },\r\n      json: true\r\n    };\r\n\r\n    request.post(authOptions, function(error, response, body) {\r\n      if (!error && response.statusCode === 200) {\r\n\r\n        var access_token = body.access_token,\r\n            refresh_token = body.refresh_token;\r\n\r\n        var options = {\r\n          url: 'https://api.spotify.com/v1/me',\r\n          headers: { 'Authorization': 'Bearer ' + access_token },\r\n          json: true\r\n        };\r\n\r\n        // use the access token to access the Spotify Web API\r\n        request.get(options, function(error, response, body) {\r\n          console.log(body);\r\n        });\r\n\r\n        // we can also pass the token to the browser to make requests from there\r\n        res.redirect('/#' +\r\n          querystring.stringify({\r\n            access_token: access_token,\r\n            refresh_token: refresh_token\r\n          }));\r\n      } else {\r\n        res.redirect('/#' +\r\n          querystring.stringify({\r\n            error: 'invalid_token'\r\n          }));\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\napp.get('/refresh_token', function(req, res) {\r\n\r\n  // requesting access token from refresh token\r\n  var refresh_token = req.query.refresh_token;\r\n  var authOptions = {\r\n    url: 'https://accounts.spotify.com/api/token',\r\n    headers: { 'Authorization': 'Basic ' + (new Buffer(client_id + ':' + client_secret).toString('base64')) },\r\n    form: {\r\n      grant_type: 'refresh_token',\r\n      refresh_token: refresh_token\r\n    },\r\n    json: true\r\n  };\r\n\r\n  request.post(authOptions, function(error, response, body) {\r\n    if (!error && response.statusCode === 200) {\r\n      var access_token = body.access_token;\r\n      res.send({\r\n        'access_token': access_token\r\n      });\r\n    }\r\n  });\r\n});\r\n\r\nconsole.log('Listening on 8888');\r\napp.listen(8888);"},"lineCount":null}},"error":null,"hash":"f30a4ba34957b0a32a851f2d7801fd13","cacheData":{"env":{}}}